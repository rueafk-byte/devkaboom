<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaboom - Web3 Game</title>
    
    <!-- Meta tags for Web3 game -->
    <meta name="description" content="Play Kaboom - The ultimate Web3 blockchain game with real token rewards!">
    <meta name="keywords" content="Web3, blockchain, game, Solana, tokens, BOOM, PIRATE, ADMIRAL">
    <meta name="author" content="Kaboom Game Team">
    
    <!-- Open Graph tags -->
    <meta property="og:title" content="Kaboom - Web3 Game">
    <meta property="og:description" content="Play Kaboom - The ultimate Web3 blockchain game with real token rewards!">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://kaboom-game.com">
    <meta property="og:image" content="/favicon.ico">
    
    <!-- Twitter Card tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Kaboom - Web3 Game">
    <meta name="twitter:description" content="Play Kaboom - The ultimate Web3 blockchain game with real token rewards!">
    <meta name="twitter:image" content="/favicon.ico">
    
    <!-- PWA manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#ff6b6b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Kaboom">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/favicon.ico">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="/web3/game-integration.js" as="script">
    <link rel="preload" href="/web3/ui-components.js" as="script">
    <link rel="preload" href="/performance-optimization.js" as="script">
    <link rel="preload" href="/Sprites/1-Player-Bomb Guy/1-Idle/1.png" as="image">
    <link rel="preload" href="/music/Cyber punk.mp3" as="audio">
    
    <!-- DNS prefetch for external resources -->
    <link rel="dns-prefetch" href="//cdn.kaboom-game.com">
    <link rel="dns-prefetch" href="//api.solana.com">
    <link rel="dns-prefetch" href="//ipapi.co">
    
    <!-- Socket.IO for real-time communication -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <!-- Solana Web3 -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    
    <!-- Performance monitoring -->
    <script>
        // Performance monitoring
        window.performanceMetrics = {
            startTime: performance.now(),
            loadTime: 0,
            firstPaint: 0,
            firstContentfulPaint: 0,
            largestContentfulPaint: 0,
            firstInputDelay: 0,
            cumulativeLayoutShift: 0
        };
        
        // Monitor performance metrics
        if ('PerformanceObserver' in window) {
            // First Paint
            new PerformanceObserver((list) => {
                const entries = list.getEntries();
                window.performanceMetrics.firstPaint = entries[0].startTime;
            }).observe({ entryTypes: ['paint'] });
            
            // First Contentful Paint
            new PerformanceObserver((list) => {
                const entries = list.getEntries();
                window.performanceMetrics.firstContentfulPaint = entries[0].startTime;
            }).observe({ entryTypes: ['paint'] });
            
            // Largest Contentful Paint
            new PerformanceObserver((list) => {
                const entries = list.getEntries();
                window.performanceMetrics.largestContentfulPaint = entries[entries.length - 1].startTime;
            }).observe({ entryTypes: ['largest-contentful-paint'] });
            
            // First Input Delay
            new PerformanceObserver((list) => {
                const entries = list.getEntries();
                entries.forEach(entry => {
                    window.performanceMetrics.firstInputDelay = entry.processingStart - entry.startTime;
                });
            }).observe({ entryTypes: ['first-input'] });
            
            // Cumulative Layout Shift
            new PerformanceObserver((list) => {
                const entries = list.getEntries();
                entries.forEach(entry => {
                    if (!entry.hadRecentInput) {
                        window.performanceMetrics.cumulativeLayoutShift += entry.value;
                    }
                });
            }).observe({ entryTypes: ['layout-shift'] });
        }
    </script>
    
    <style>
        /* Critical CSS for above-the-fold content */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        
        #gameCanvas {
            display: block;
            margin: 0 auto;
            background: #000;
            border: 2px solid #333;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
            font-size: 24px;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-progress {
            width: 300px;
            height: 10px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .loading-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .loading-text {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 10px;
        }
        
        /* Hide loading screen when game is ready */
        .game-ready .loading-screen {
            display: none;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            #gameCanvas {
                width: 100%;
                height: auto;
                max-width: 100vw;
                max-height: 100vh;
            }
        }
        
        /* High DPI displays */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            #gameCanvas {
                image-rendering: -webkit-optimize-contrast;
                image-rendering: crisp-edges;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <h1>ðŸŽ® Kaboom Game</h1>
        <div class="loading-progress">
            <div class="loading-bar" id="loadingBar"></div>
        </div>
        <div class="loading-text" id="loadingText">Initializing Web3 connection...</div>
    </div>
    
    <!-- Game Canvas -->
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    
    <!-- Game UI will be injected by ui-components.js -->
    
    <!-- Core Game Scripts -->
    <script src="/game.js" defer></script>
    
    <!-- Web3 Integration -->
    <script src="/web3/game-integration.js" defer></script>
    <script src="/web3/ui-components.js" defer></script>
    
    <!-- Performance Optimization -->
    <script src="/performance-optimization.js" defer></script>
    
    <!-- Game Initialization -->
    <script>
        // Game initialization
        let gameLoaded = false;
        let web3Loaded = false;
        let uiLoaded = false;
        let performanceLoaded = false;
        
        // Loading progress tracking
        let loadingProgress = 0;
        const loadingBar = document.getElementById('loadingBar');
        const loadingText = document.getElementById('loadingText');
        
        function updateLoadingProgress(progress, text) {
            loadingProgress = Math.min(loadingProgress + progress, 100);
            loadingBar.style.width = loadingProgress + '%';
            if (text) loadingText.textContent = text;
            
            if (loadingProgress >= 100) {
                setTimeout(() => {
                    document.body.classList.add('game-ready');
                    initializeGame();
                }, 500);
            }
        }
        
        // Check if all components are loaded
        function checkAllLoaded() {
            if (gameLoaded && web3Loaded && uiLoaded && performanceLoaded) {
                updateLoadingProgress(25, 'All components loaded!');
            }
        }
        
        // Game script loaded
        window.addEventListener('load', () => {
            if (typeof Game !== 'undefined') {
                gameLoaded = true;
                updateLoadingProgress(25, 'Game engine loaded...');
                checkAllLoaded();
            }
        });
        
        // Web3 integration loaded
        if (typeof GameIntegration !== 'undefined') {
            web3Loaded = true;
            updateLoadingProgress(25, 'Web3 integration loaded...');
            checkAllLoaded();
        } else {
            // Wait for script to load
            const checkWeb3 = setInterval(() => {
                if (typeof GameIntegration !== 'undefined') {
                    web3Loaded = true;
                    updateLoadingProgress(25, 'Web3 integration loaded...');
                    checkAllLoaded();
                    clearInterval(checkWeb3);
                }
            }, 100);
        }
        
        // UI components loaded
        if (typeof GameUI !== 'undefined') {
            uiLoaded = true;
            updateLoadingProgress(25, 'UI components loaded...');
            checkAllLoaded();
        } else {
            // Wait for script to load
            const checkUI = setInterval(() => {
                if (typeof GameUI !== 'undefined') {
                    uiLoaded = true;
                    updateLoadingProgress(25, 'UI components loaded...');
                    checkAllLoaded();
                    clearInterval(checkUI);
                }
            }, 100);
        }
        
        // Performance optimization loaded
        if (typeof PerformanceOptimizer !== 'undefined') {
            performanceLoaded = true;
            updateLoadingProgress(25, 'Performance optimization loaded...');
            checkAllLoaded();
        } else {
            // Wait for script to load
            const checkPerformance = setInterval(() => {
                if (typeof PerformanceOptimizer !== 'undefined') {
                    performanceLoaded = true;
                    updateLoadingProgress(25, 'Performance optimization loaded...');
                    checkAllLoaded();
                    clearInterval(checkPerformance);
                }
            }, 100);
        }
        
        // Initialize game when everything is ready
        function initializeGame() {
            try {
                // Initialize game components
                if (window.gameIntegration) {
                    window.gameIntegration.init();
                }
                
                if (window.gameUI) {
                    window.gameUI.init();
                }
                
                if (window.performanceOptimizer) {
                    window.performanceOptimizer.init();
                }
                
                // Start the game
                if (typeof Game !== 'undefined') {
                    const game = new Game();
                    game.start();
                }
                
                // Report performance metrics
                setTimeout(() => {
                    if (window.performanceOptimizer) {
                        window.performanceOptimizer.reportPerformanceMetrics();
                    }
                }, 5000);
                
                console.log('ðŸŽ® Kaboom Game initialized successfully!');
                
            } catch (error) {
                console.error('Failed to initialize game:', error);
                loadingText.textContent = 'Failed to initialize game. Please refresh the page.';
            }
        }
        
        // Handle errors
        window.addEventListener('error', (event) => {
            console.error('Game error:', event.error);
            loadingText.textContent = 'An error occurred. Please refresh the page.';
        });
        
        // Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
            loadingText.textContent = 'An error occurred. Please refresh the page.';
        });
        
        // Service Worker registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    console.log('Service Worker registered:', registration);
                })
                .catch(error => {
                    console.error('Service Worker registration failed:', error);
                });
        }
        
        // Performance monitoring
        window.addEventListener('load', () => {
            window.performanceMetrics.loadTime = performance.now() - window.performanceMetrics.startTime;
            
            // Send performance metrics to analytics
            setTimeout(() => {
                fetch('/api/analytics/performance', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(window.performanceMetrics)
                }).catch(error => {
                    console.error('Failed to send performance metrics:', error);
                });
            }, 1000);
        });
    </script>
</body>
</html>
